<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betamax: Blood Management System</title>
    <link rel="stylesheet" href="lyka.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <img src="logo_text.png" alt="Logo" class="logo">
    <div class="login-container">
        <form class="login-form" action="register.php" method="post">
            <img src="login.png" alt="Login Profile" class="login-profile">
            <h2>CREATE ACCOUNT</h2>
            <div class="form-group">
                <input type="text" id="name" name="name" placeholder="Name" required>
            </div>
            <div class="form-group">
                <input type="email" id="email" name="email" placeholder="Email Address" required>
            </div>
            <div class="form-group">
                <input type="text" id="phone" name="phone" placeholder="Phone Number" required>
            </div>
            <div class="form-group">
                <input type="password" id="password" name="password" placeholder="Password" required>
            </div>
            <button type="submit" class="login-button">SIGN UP</button>
        </form>
    </div>
</body>
</html>

<script>
    const form = document.getElementById('form');
    const name = document.getElementById('name');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const phone = document.getElementById('phone');
    
    form.addEventListener('submit', e => {
        e.preventDefault(); // Prevent the default form submission behavior
    
        // Validate inputs
        validateInputs();
    
        // Check if all inputs are valid before allowing form submission
        if (name.parentElement.classList.contains('success') &&
            email.parentElement.classList.contains('success') &&
            password.parentElement.classList.contains('success') &&
            number.parentElement.classList.contains('success')) {
                const formData = new FormData(form);
    
                // Send form data to the server using AJAX
                const xhr = new XMLHttpRequest();
                xhr.open('POST', 'register.php', true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // Handle successful response from server
                            console.log('Form data submitted successfully');
                            // Redirect the user after successful submission
                            window.location.href = '4-dash.html';
                        } else {
                            // Handle error response from server
                            console.error('Error submitting form data:', xhr.status);
                            // Optionally, display an error message to the user
                        }
                    }
                };
                xhr.send(formData);
        } else {
            // If any input validation fails, prevent the form submission
            console.log('Form submission prevented because of invalid inputs.');
        }
    });
    
    const setError = (element, message) => {
        const inputControl = element.parentElement;
        const errorDisplay = inputControl.querySelector('.error');
    
        errorDisplay.innerText = message;
        inputControl.classList.add('error');
        inputControl.classList.remove('success')
    };
    
    const setSuccess = element => {
        const inputControl = element.parentElement;
        const errorDisplay = inputControl.querySelector('.error');
    
        errorDisplay.innerText = '';
        inputControl.classList.add('success');
        inputControl.classList.remove('error');
    };
    
    const isValidEmail = email => {
        const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(String(email).toLowerCase());
    };
    
    const validateInputs = () => {
        const nameValue = name.value.trim();
        const emailValue = email.value.trim();
        const passwordValue = password.value.trim();
        const phoneValue = phone.value.trim();
    
        if(nameValue === '') {
            setError(name, 'First Name is required');
        } else {
            setSuccess(name);
        }
    
        if(emailValue === '') {
            setError(email, 'Email is required');
        } else if (!isValidEmail(emailValue)) {
            setError(email, 'Provide a valid email address');
        } else {
            setSuccess(email);
        }
    
        if(passwordValue === '') {
            setError(password, 'Password is required');
        } else if (passwordValue.length < 8 ) {
            setError(password, 'Password must be at least 8 characters long.')
        }
        else if (!/[A-Z]/.test(passwordValue)) {
            setError(password, 'Password must contain at least one uppercase letter.');
        }
        else if (!/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]/.test(passwordValue)) {
            setError(password, 'Password must contain at least one special character.');
        } 
         else {
            setSuccess(password);
        }
    
        if(phoneValue === '') {
            setError(phone, 'Contact Number is required');
        }
        else if (numberValue.length < 11 ) {
            setError(phone, 'Contact Number must be 11 characters long.')
        } 
        else if (numberValue.length > 12 ) {
            setError(phone, 'Contact Number must be 11 characters long.')
        } 
        else {
            setSuccess(phone);
        }
    
    }
    </script>
