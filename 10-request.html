<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betamax: Blood Management System</title>
    <link rel="stylesheet" href="dash.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <div class="left">
                    <a href="4-dash.html">
                    <img src="logo_notext.png" alt="logo" height="65px" width="65px">
                    </a>
                </div>
                <div class="center">
                    <a href="4-dash.html">
                    <img src="textlogo.png" alt="logo" height="80px"> 
                </a>
                </div>
                <div class="right">
                    <a href="14-profile.html">
                        <img src="profile.png" alt="logo" height="40px" width="40px">
                    </a>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <div class="content-container">
            <section id="faqs">
                <h2><a href="13-faqs.html">FAQs</a></h2>
            </section>
            <div class="right-content">
                <section id="donate">
                    <h2><a href="5-donate.html">DONATE</a></h2>
                </section>
                <section id="request">
                    <h2><a href="10-request.html">REQUEST</a></h2>
                </section>
            </div>
        </div>
    </main>
    <div class="flex-container">
        <div class="left-side">
            <img src="blood-inventory.png" alt="Blood Inventory" height="60px" width="500px">
        </div>
        <div class="right-side">
            <a href="11-cart.php">
            <img src="cart.png" alt="Cart" height="30px" width="30px">
            </a>
        </div>
    </div>
    <div class="product-container-upper">
        <div class="a-plus">
            <img src="A+.png" alt="A+" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="A+"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="A+" alt="add" height="20px" width="20px">
            </div>
        </div>
        <div class="a-minus">
            <img src="A-.png" alt="A-" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="A-"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="A-" alt="add" height="20px" width="20px">
            </div>
        </div>
        <div class="b-plus">
            <img src="B+.png" alt="B+" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="B+"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="B+" alt="add" height="20px" width="20px">
            </div>
        </div>
        <div class="b-minus">
            <img src="B-.png" alt="B-" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="B-"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="B-" alt="add" height="20px" width="20px">
            </div>
        </div>
    </div>
    <div class="product-container-lower">
        <div class="o-plus">
            <img src="O+.png" alt="O+" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="O+"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="O+" alt="add" height="20px" width="20px">
            </div>
        </div>
        <div class="o-minus">
            <img src="O-.png" alt="O-" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="O-"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="O-" alt="add" height="20px" width="20px">
            </div>
        </div>
        <div class="ab-plus">
            <img src="AB+.png" alt="AB+" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="AB+"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="AB+" alt="add" height="20px" width="20px">
            </div>
        </div>
        <div class="ab-minus">
            <img src="AB-.png" alt="AB-" height="250px" width="250px">
            <div class="stock-info">
                <h4>Stock: <span class="stock-count" data-blood-type="AB-"></span></h4>
                <img src="add-to-cart.png" class="add-to-cart" data-blood-type="AB-" alt="add" height="20px" width="20px">
            </div>
        </div>
    </div>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            // Fetch stock data from the server
            fetch('get_stock.php')
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        const stockCountElement = document.querySelector(`.stock-count[data-blood-type="${item.blood_type}"]`);
                        stockCountElement.textContent = item.stock;
                    });
                });
        
            const addToCartButtons = document.querySelectorAll('.add-to-cart');
        
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const bloodType = this.dataset.bloodType;
                    const stockCountElement = document.querySelector(`.stock-count[data-blood-type="${bloodType}"]`);
                    let stockCount = parseInt(stockCountElement.textContent);
        
                    if (stockCount > 0) {
                        stockCountElement.textContent = stockCount - 1;
        
                        fetch('update_cart.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ blood_type: bloodType })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('Item added to cart');
                            } else {
                                alert('Failed to add item to cart');
                            }
                        });
                    } else {
                        alert('Stock is empty');
                    }
                });
            });
        });
</script>
        
</body>
</html>
